From 1817771c3813ca7b43d41d78f30071bcaede6e7a Mon Sep 17 00:00:00 2001
From: Longwu Ou <xulongwu4@gmail.com>
Date: Sun, 3 Jan 2021 14:58:06 -0500
Subject: [PATCH] Add support for stateless configuration

---
 config/config.toml.centos | 7 +++++++
 pkg/hook_config.go        | 2 ++
 2 files changed, 9 insertions(+)

diff --git a/config/config.toml.centos b/config/config.toml.centos
index 24e8e7f..e952183 100644
--- a/config/config.toml.centos
+++ b/config/config.toml.centos
@@ -1,3 +1,10 @@
+#
+# nvidia-container-toolkit default configuration
+#
+# Do not make changes to this file. nvidia-container-toolkit is implemented in a stateless
+# fashion on Solus, and will load files in a layered mechanism. If you wish to edit
+# this configuration, copy to /etc/nvidia-container-runtime/.
+
 disable-require = false
 #swarm-resource = "DOCKER_RESOURCE_GPU"
 #accept-nvidia-visible-devices-envvar-when-unprivileged = true
diff --git a/pkg/hook_config.go b/pkg/hook_config.go
index 0f809c7..c0f7bea 100644
--- a/pkg/hook_config.go
+++ b/pkg/hook_config.go
@@ -11,11 +11,13 @@ import (
 const (
 	configPath = "/etc/nvidia-container-runtime/config.toml"
 	driverPath = "/run/nvidia/driver"
+	defaultconfigPath = "/usr/share/nvidia-container-runtime/config.toml"
 )
 
 var defaultPaths = [...]string{
 	path.Join(driverPath, configPath),
 	configPath,
+	defaultconfigPath,
 }
 
 // CLIConfig : options for nvidia-container-cli.
-- 
2.29.2

